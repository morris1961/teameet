{"version":3,"sources":["../backend/server.js"],"names":["dotenv","config","mongo","connect","app","server","http","createServer","use","express","wss","WebSocket","Server","on","ws","console","log","sendEvent","e","send","JSON","stringify","incoming","message","parse","api","data","msg","then","ret","connection","PORT","process","env","port","listen"],"mappings":"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","sourcesContent":["// import packages\r\nimport http from 'http';\r\nimport express from 'express';\r\nimport dotenv from 'dotenv-defaults';\r\nimport WebSocket from 'ws';\r\n\r\n// connect mongo\r\nimport mongo from './functions/mongo.js';\r\ndotenv.config();\r\nmongo.connect();\r\n\r\n// import functions\r\nimport register from './functions/register.js';\r\nimport login from './functions/login.js';\r\nimport createGroup from './functions/createGroup.js';\r\nimport joinGroup from './functions/joinGroup.js';\r\nimport index from './functions/index.js';\r\nimport renewProfile from './functions/renewProfile.js';\r\nimport group from './functions/group.js';\r\nimport renewFile from './functions/renewFile.js';\r\nimport createDiscussion from './functions/createDisscussion.js';\r\nimport discussion from './functions/discussion.js';\r\nimport time from './functions/time.js';\r\nimport place from './functions/place.js';\r\nimport voteTime from './functions/voteTime.js';\r\nimport addPlace from './functions/addPlace.js';\r\nimport votePlace from './functions/votePlace.js';\r\nimport confirmTime from './functions/confirmTime.js';\r\nimport confirmPlace from './functions/confirmPlace.js';\r\nimport send from './functions/message.js';\r\nimport chat from './functions/chat.js';\r\n\r\n// init server\r\nconst app = express();\r\nconst server = http.createServer(app);\r\napp.use(express.static(\"./public\"));\r\nconst wss = new WebSocket.Server({\r\n  server,\r\n});\r\n\r\nwss.on('connection', async function connection(ws) {\r\n\r\n  // init ws\r\n  console.log('server connected!')\r\n  ws.sendEvent = (e) => ws.send(JSON.stringify(e));\r\n\r\n  // handle message\r\n  ws.on('message', function incoming(message) {\r\n    message = JSON.parse(message);\r\n    const { api, data } = message;\r\n    console.log(api, data)\r\n    var msg = {};\r\n    msg.api = api;\r\n    switch (api) {\r\n      case \"register\":\r\n        register(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"login\":\r\n        login(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n            console.log(\"login_msg\", msg)\r\n          }\r\n        );\r\n        break;\r\n      case \"index\":\r\n        index(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"createGroup\":\r\n        createGroup(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"joinGroup\":\r\n        joinGroup(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"renewProfile\":\r\n        renewProfile(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"group\":\r\n        group(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"renewFile\":\r\n        renewFile(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"createDiscussion\":\r\n        createDiscussion(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"discussion\":\r\n        discussion(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"time\":\r\n        time(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"place\":\r\n        place(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"voteTime\":\r\n        voteTime(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"addPlace\":\r\n        addPlace(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"votePlace\":\r\n        votePlace(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"confirmPlace\":\r\n        confirmPlace(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"confirmTime\":\r\n        confirmTime(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"chat\":\r\n        chat(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      case \"message\":\r\n        send(data).then(\r\n          (ret) => {\r\n            msg.data = ret;\r\n            ws.sendEvent(msg);\r\n          }\r\n        );\r\n        break;\r\n      default:\r\n        console.log(message);\r\n        break;\r\n    }\r\n  });\r\n});\r\n\r\nconst PORT = process.env.port || 4000\r\nserver.listen(PORT, () => {\r\n  console.log(`Listening on http://localhost:${PORT}`)\r\n})\r\n"],"file":"server.js"}