{"version":3,"sources":["../../backend/functions/message.js"],"names":["message","UID","GID","body","status","UName","messages","error_msg","nowTime","Date","User","findById","user","groups","indexOf","Group","group","newMessage","Message","time","sender","save","push","updateOne","$set","console","log"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;SAEeA,O;;;;;qEAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAyBC,YAAAA,GAAzB,QAAyBA,GAAzB,EAA8BC,GAA9B,QAA8BA,GAA9B,EAAmCC,IAAnC,QAAmCA,IAAnC;AACMC,YAAAA,MADN,GACe,KADf;AAEMC,YAAAA,KAFN,GAEc,EAFd;AAGMC,YAAAA,QAHN,GAGiB,EAHjB;AAIMC,YAAAA,SAJN,GAIkB,oBAJlB;AAAA;AAMUC,YAAAA,QANV,GAMoB,IAAIC,IAAJ,EANpB;AAAA;AAAA,mBAOuBC,iBAAKC,QAAL,CAAcV,GAAd,CAPvB;;AAAA;AAOUW,YAAAA,IAPV;;AAAA,gBAQSA,IART;AAAA;AAAA;AAAA;;AASMR,YAAAA,MAAM,GAAG,KAAT;AACAG,YAAAA,SAAS,GAAG,wBAAZ;AAVN,6CAWa;AAAEH,cAAAA,MAAM,EAANA,MAAF;AAAUG,cAAAA,SAAS,EAATA;AAAV,aAXb;;AAAA;AAAA,kBAaQK,IAAI,CAACC,MAAL,CAAYC,OAAZ,CAAoBZ,GAApB,MAA6B,CAAC,CAbtC;AAAA;AAAA;AAAA;;AAcME,YAAAA,MAAM,GAAG,KAAT;AACAG,YAAAA,SAAS,GAAG,+BAAZ;AAfN,6CAgBa;AAAEH,cAAAA,MAAM,EAANA,MAAF;AAAUG,cAAAA,SAAS,EAATA;AAAV,aAhBb;;AAAA;AAAA;AAAA,mBAmBwBQ,kBAAMJ,QAAN,CAAeT,GAAf,CAnBxB;;AAAA;AAmBUc,YAAAA,KAnBV;;AAAA,gBAoBSA,KApBT;AAAA;AAAA;AAAA;;AAqBMZ,YAAAA,MAAM,GAAG,KAAT;AACAG,YAAAA,SAAS,GAAG,yBAAZ;AAtBN,6CAuBa;AAAEH,cAAAA,MAAM,EAANA,MAAF;AAAUG,cAAAA,SAAS,EAATA;AAAV,aAvBb;;AAAA;AA0BUU,YAAAA,UA1BV,GA0BuB,IAAIC,oBAAJ,CAAY;AAAEC,cAAAA,IAAI,EAAEX,QAAR;AAAiBY,cAAAA,MAAM,EAAEnB,GAAzB;AAA8BE,cAAAA,IAAI,EAAJA;AAA9B,aAAZ,CA1BvB;AAAA;AAAA,mBA2BUc,UAAU,CAACI,IAAX,EA3BV;;AAAA;AA6BIf,YAAAA,QAAQ,GAAGU,KAAK,CAACV,QAAjB;AACAA,YAAAA,QAAQ,CAACgB,IAAT,CAAcL,UAAd;AA9BJ;AAAA,mBA+BUD,KAAK,CAACO,SAAN,CAAgB;AAAEC,cAAAA,IAAI,EAAE;AAAElB,gBAAAA,QAAQ,EAARA;AAAF;AAAR,aAAhB,CA/BV;;AAAA;AAiCID,YAAAA,KAAK,GAAGO,IAAI,CAACP,KAAb;AACAD,YAAAA,MAAM,GAAG,IAAT;AACAG,YAAAA,SAAS,GAAG,YAAZ;AAnCJ;AAAA;;AAAA;AAAA;AAAA;AAqCIkB,YAAAA,OAAO,CAACC,GAAR;AACAtB,YAAAA,MAAM,GAAG,KAAT;AACAG,YAAAA,SAAS,GAAG,oBAAZ;AAAiC;;AAvCrC;AAAA,6CAyCS;AAAEH,cAAAA,MAAM,EAANA,MAAF;AAAUe,cAAAA,IAAI,EAAEX,OAAhB;AAAyBY,cAAAA,MAAM,EAAEf,KAAjC;AAAwCF,cAAAA,IAAI,EAAJA,IAAxC;AAA8CI,cAAAA,SAAS,EAATA;AAA9C,aAzCT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;eA4CeP,O","sourcesContent":["import Group from \"../models/group.js\";\r\nimport User from \"../models/user.js\";\r\nimport Message from \"../models/message.js\";\r\n\r\nasync function message({ UID, GID, body }) {\r\n  var status = false;\r\n  var UName = \"\";\r\n  var messages = [];\r\n  var error_msg = \"Something wrong...\";\r\n  try {\r\n    const nowTime = new Date();\r\n    const user = await User.findById(UID)\r\n    if (!user) {\r\n      status = false;\r\n      error_msg = \"The user is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    if (user.groups.indexOf(GID) === -1) {\r\n      status = false;\r\n      error_msg = \"The user is not in the group!\"\r\n      return { status, error_msg };\r\n    }\r\n\r\n    const group = await Group.findById(GID);\r\n    if (!group) {\r\n      status = false;\r\n      error_msg = \"The group is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n\r\n    const newMessage = new Message({ time: nowTime, sender: UID, body });\r\n    await newMessage.save();\r\n\r\n    messages = group.messages;\r\n    messages.push(newMessage);\r\n    await group.updateOne({ $set: { messages } });\r\n\r\n    UName = user.UName;\r\n    status = true;\r\n    error_msg = \"Successed!\";\r\n  } catch (e) {\r\n    console.log(e)\r\n    status = false;\r\n    error_msg = \"Something wrong...\";;\r\n  }\r\n  return { status, time: nowTime, sender: UName, body, error_msg };\r\n}\r\n\r\nexport default message;"],"file":"message.js"}