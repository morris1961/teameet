{"version":3,"sources":["../../backend/functions/index.js"],"names":["index","UID","status","UName","voting","recent","group","error_msg","now","Date","getTime","User","findById","user","groups","i","length","Group","aGroup","push","GID","_id","GName","discussions","j","Discussion","aDiscussion","deadline","DID","subject","time_result","place","place_result","sort","a","b","console","log"],"mappings":"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","sourcesContent":["// import models\r\nimport Group from '../models/group.js';\r\nimport User from '../models/user.js';\r\nimport Discussion from '../models/discussion.js';\r\n\r\n// function for every cases\r\nasync function index({ UID }) {\r\n  var status = false;\r\n  var UName = \"\";\r\n  var voting = []; // todo\r\n  var recent = []; // todo\r\n  var group = [];\r\n  var error_msg = \"Something wrong...\";\r\n  try {\r\n    const now = new Date().getTime();\r\n    const user = await User.findById(UID);\r\n    if (!user) {\r\n      status = false;\r\n      error_msg = \"The user is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    UName = user.UName;\r\n    var groups = user.groups;\r\n    for (let i = 0; i < groups.length; i++) {\r\n      const aGroup = await Group.findById(groups[i]);\r\n      group.push({ GID: aGroup._id, GName: aGroup.GName });\r\n      const discussions = aGroup.discussions;\r\n      for (let j = 0; j < discussions.length; j++) {\r\n        const aDiscussion = await Discussion.findById(discussions[j])\r\n        // before deadline\r\n        if ((now - aDiscussion.deadline.getTime()) < 0) {\r\n          voting.push({\r\n            GID: aGroup._id,\r\n            DID: aDiscussion._id,\r\n            GName: aGroup.GName,\r\n            subject: aDiscussion.subject,\r\n            time_result: aDiscussion.time_result,\r\n            place: aDiscussion.place_result,\r\n            deadline: aDiscussion.deadline,\r\n          })\r\n        }\r\n        // after deadline\r\n        else {\r\n          // before discussion time result\r\n          if (now - aDiscussion.time_result.getTime() < 0) {\r\n            recent.push({\r\n              GID: aGroup._id,\r\n              DID: aDiscussion._id,\r\n              GName: aGroup.GName,\r\n              subject: aDiscussion.subject,\r\n              time_result: aDiscussion.time_result,\r\n              place: aDiscussion.place_result,\r\n            })\r\n          }\r\n        }\r\n      }\r\n    }\r\n    voting.sort((a, b) => (a.deadline.getTime() < b.deadline.getTime()) ? 1 : ((b.deadline.getTime() < a.deadline.getTime()) ? -1 : 0))\r\n    recent.sort((a, b) => (a.time_result.getTime() < b.time_result.getTime()) ? 1 : ((b.time_result.getTime() < a.time_result.getTime()) ? -1 : 0))\r\n    status = true\r\n    error_msg = \"Successed!\";\r\n  } catch (e) {\r\n    console.log(e)\r\n    status = false;\r\n    error_msg = \"Something wrong...\";;\r\n  }\r\n  return { status, UName, recent, voting, group, error_msg };\r\n}\r\n\r\nexport default index;"],"file":"index.js"}