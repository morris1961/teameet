{"version":3,"sources":["../../backend/functions/chat.js"],"names":["chat","UID","GID","status","messages","error_msg","User","findById","user","groups","indexOf","Group","populate","path","group","map","time","body","UName","sender","console","log"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;SAEeA,I;;;;;kEAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsBC,YAAAA,GAAtB,QAAsBA,GAAtB,EAA2BC,GAA3B,QAA2BA,GAA3B;AACMC,YAAAA,MADN,GACe,KADf;AAEMC,YAAAA,QAFN,GAEiB,EAFjB;AAGMC,YAAAA,SAHN,GAGkB,oBAHlB;AAAA;AAAA;AAAA,mBAKuBC,iBAAKC,QAAL,CAAcN,GAAd,CALvB;;AAAA;AAKUO,YAAAA,IALV;;AAAA,gBAMSA,IANT;AAAA;AAAA;AAAA;;AAOML,YAAAA,MAAM,GAAG,KAAT;AACAE,YAAAA,SAAS,GAAG,wBAAZ;AARN,6CASa;AAAEF,cAAAA,MAAM,EAANA,MAAF;AAAUE,cAAAA,SAAS,EAATA;AAAV,aATb;;AAAA;AAAA,kBAWQG,IAAI,CAACC,MAAL,CAAYC,OAAZ,CAAoBR,GAApB,MAA6B,CAAC,CAXtC;AAAA;AAAA;AAAA;;AAYMC,YAAAA,MAAM,GAAG,KAAT;AACAE,YAAAA,SAAS,GAAG,+BAAZ;AAbN,6CAca;AAAEF,cAAAA,MAAM,EAANA,MAAF;AAAUE,cAAAA,SAAS,EAATA;AAAV,aAdb;;AAAA;AAAA;AAAA,mBAiBwBM,kBAAMJ,QAAN,CAAeL,GAAf,EAAoBU,QAApB,CAA6B;AAAEC,cAAAA,IAAI,EAAE,UAAR;AAAoBD,cAAAA,QAAQ,EAAE;AAA9B,aAA7B,CAjBxB;;AAAA;AAiBUE,YAAAA,KAjBV;;AAAA,gBAkBSA,KAlBT;AAAA;AAAA;AAAA;;AAmBMX,YAAAA,MAAM,GAAG,KAAT;AACAE,YAAAA,SAAS,GAAG,yBAAZ;AApBN,6CAqBa;AAAEF,cAAAA,MAAM,EAANA,MAAF;AAAUE,cAAAA,SAAS,EAATA;AAAV,aArBb;;AAAA;AAuBID,YAAAA,QAAQ,GAAGU,KAAK,CAACV,QAAN,CAAeW,GAAf,CAAmB;AAAA,kBAAGC,IAAH,SAAGA,IAAH;AAAA,kBAASC,IAAT,SAASA,IAAT;AAAA,kBAAyBC,KAAzB,SAAeC,MAAf,CAAyBD,KAAzB;AAAA,qBAAwC;AACpEF,gBAAAA,IAAI,EAAJA,IADoE;AAEpEG,gBAAAA,MAAM,EAAED,KAF4D;AAGpED,gBAAAA,IAAI,EAAJA;AAHoE,eAAxC;AAAA,aAAnB,CAAX;AAKAd,YAAAA,MAAM,GAAG,IAAT;AACAE,YAAAA,SAAS,GAAG,YAAZ;AA7BJ;AAAA;;AAAA;AAAA;AAAA;AA+BIe,YAAAA,OAAO,CAACC,GAAR;AACAlB,YAAAA,MAAM,GAAG,KAAT;AACAE,YAAAA,SAAS,GAAG,oBAAZ;AAAiC;;AAjCrC;AAAA,6CAmCS;AAAEF,cAAAA,MAAM,EAANA,MAAF;AAAUC,cAAAA,QAAQ,EAARA,QAAV;AAAoBC,cAAAA,SAAS,EAATA;AAApB,aAnCT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;eAsCeL,I","sourcesContent":["import Group from \"../models/group.js\";\r\nimport User from \"../models/user.js\";\r\nimport Message from \"../models/message.js\";\r\n\r\nasync function chat({ UID, GID }) {\r\n  var status = false;\r\n  var messages = [];\r\n  var error_msg = \"Something wrong...\";\r\n  try {\r\n    const user = await User.findById(UID)\r\n    if (!user) {\r\n      status = false;\r\n      error_msg = \"The user is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    if (user.groups.indexOf(GID) === -1) {\r\n      status = false;\r\n      error_msg = \"The user is not in the group!\"\r\n      return { status, error_msg };\r\n    }\r\n\r\n    const group = await Group.findById(GID).populate({ path: 'messages', populate: 'sender' });\r\n    if (!group) {\r\n      status = false;\r\n      error_msg = \"The group is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    messages = group.messages.map(({ time, body, sender: { UName } }) => ({\r\n      time,\r\n      sender: UName,\r\n      body\r\n    }))\r\n    status = true;\r\n    error_msg = \"Successed!\";\r\n  } catch (e) {\r\n    console.log(e)\r\n    status = false;\r\n    error_msg = \"Something wrong...\";;\r\n  }\r\n  return { status, messages, error_msg };\r\n}\r\n\r\nexport default chat;"],"file":"chat.js"}