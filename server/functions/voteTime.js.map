{"version":3,"sources":["../../backend/functions/voteTime.js"],"names":["time","UID","DID","times","status","reTime_options","error_msg","Discussion","findById","discussion","Date","getTime","deadline","time_options","j","length","toDate","key","value","toISOString","replace","newArray","push","set","updateOne","$set","console","log"],"mappings":"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","sourcesContent":["// import models\r\nimport Discussion from '../models/discussion.js'\r\nimport moment from 'moment';\r\nimport 'moment-timezone';\r\n\r\n// function for every cases\r\nasync function time({ UID, DID, times }) {\r\n  var status = false;\r\n  var reTime_options = {};\r\n  var error_msg = \"Something wrong...\";\r\n  try {\r\n    const discussion = await Discussion.findById(DID);\r\n    if (!discussion) {\r\n      status = false;\r\n      error_msg = \"The discussion is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    if ((new Date().getTime() - discussion.deadline.getTime()) >= 0) {\r\n      status = false;\r\n      error_msg = \"The deadline has arrived!\"\r\n      return { status, error_msg };\r\n    }\r\n    var time_options = discussion.time_options;\r\n    for (let j = 0; j < times.length; j++) {\r\n      const time = new Date(moment(times[j]).toDate());\r\n      for (var [key, value] of time_options) {\r\n        if (key === time.toISOString().replace(\".\", \" \")) {\r\n          var newArray = value.push(UID);\r\n          time_options.set(key, newArray);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    for (var [key, value] of time_options) {\r\n      reTime_options[key.replace(\" \", \".\")] = value;\r\n    }\r\n    await discussion.updateOne({ $set: { time_options } })\r\n    status = true;\r\n    error_msg = \"Successed!\";\r\n  } catch (e) {\r\n    console.log(e)\r\n    status = false;\r\n    error_msg = \"Something wrong...\";;\r\n  }\r\n  return { status, time_options: reTime_options, error_msg };\r\n}\r\n\r\nexport default time;"],"file":"voteTime.js"}