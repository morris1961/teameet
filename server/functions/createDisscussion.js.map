{"version":3,"sources":["../../backend/functions/createDisscussion.js"],"names":["createDiscussion","GID","UID","subject","content","time_start","time_span","time_end","deadline","place","status","DID","error_msg","discussions","Date","toDate","parseInt","Group","findById","group","time_options","Map","time_option","set","toISOString","replace","getTime","setMinutes","getMinutes","place_options","discussion","Discussion","admin","save","_id","newDiscussions","push","updateOne","i","length","aDisscussion","console","log"],"mappings":"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","sourcesContent":["// import models\r\nimport Group from '../models/group.js'\r\nimport Discussion from '../models/discussion.js'\r\nimport moment from \"moment\";\r\n\r\n// function for every cases\r\nasync function createDiscussion({ GID, UID, subject, content, time_start, time_span, time_end, deadline, place }) {\r\n  var status = false;\r\n  var DID = \"\";\r\n  var error_msg = \"Something wrong...\";\r\n  var discussions = [];\r\n  time_start = new Date(moment(time_start).toDate());\r\n  time_end = new Date(moment(time_end).toDate());\r\n  deadline = new Date(moment(deadline).toDate());\r\n  time_span = parseInt(time_span);\r\n  try {\r\n    const group = await Group.findById(GID);\r\n    if (!group) {\r\n      status = false;\r\n      error_msg = \"The group is not valid!\"\r\n      return { status, error_msg };\r\n    }\r\n    var time_options = new Map();\r\n    var time_option = time_start;\r\n    time_options.set(time_option.toISOString().replace(\".\", \" \"), []);\r\n    while (time_option.getTime() < time_end.getTime()) {\r\n      time_option.setMinutes(time_option.getMinutes() + time_span);\r\n      time_options.set(time_option.toISOString().replace(\".\", \" \"), []);\r\n    }\r\n    var place_options = {};\r\n    place_options[place] = [];\r\n    const discussion = new Discussion({ admin: UID, subject, time_start, time_end, time_span, deadline, content, place_options, time_options });\r\n    await discussion.save();\r\n    DID = discussion._id;\r\n\r\n    const newDiscussions = group.discussions;\r\n    newDiscussions.push(DID);\r\n    await group.updateOne({ discussions: newDiscussions });\r\n\r\n    for (let i = 0; i < group.discussions.length; i++) {\r\n      const aDisscussion = await Discussion.findById(group.discussions[i]);\r\n      discussions.push({ DID: aDisscussion._id, subject: aDisscussion.subject });\r\n    }\r\n\r\n    status = true;\r\n    error_msg = \"Successed!\";\r\n  } catch (e) {\r\n    console.log(e)\r\n    status = false;\r\n    error_msg = \"Something wrong...\";;\r\n  }\r\n  return { status, DID, discussions, error_msg };\r\n}\r\n\r\nexport default createDiscussion;"],"file":"createDisscussion.js"}